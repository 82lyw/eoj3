{% extends 'base.jinja2' %}
{% from 'components/username_display.jinja2' import username_display with context %}

{% block title %}{{ blog.title }} - Blog - {% endblock %}

{% block page_header %}{{ blog.title }}{% endblock %}

{% block content %}
  {% set flag = '' %}

    {% if user.is_authenticated %}
        {% set item = blog.bloglikes_set.get(user=user) %}
        {% if item!=None %}
            {% set flag = item.flag%}
        {% endif %}
    {% endif %}

  <p>{{ username_display(blog.author, tiny=True) }} edited {{ blog.edit_time | naturaltime }}
  {% if is_privileged %}<a href="{{ url('blog:update', blog.pk) }}"><i class="ui icon edit"></i></a>{% endif %}</p>
  {{ blog.text | markdown | safer | safe }}
  <div class="actions">
    <a class="blog-like-link like-link" data-link="{{ url('blog:like') }}" data-comment="{{ blog.pk }}" data-flag="like">
      <i class="thumbs up {% if flag != 'like' %}outline{% endif %} icon"></i>
      <span>{{ blog.bloglikes_set.filter(flag='like').count() }}</span>
    </a>
    <a class="blog-like-link like-link" data-link="{{ url('blog:like') }}" data-comment="{{ blog.pk }}" data-flag="dislike">
      <i class="thumbs down {% if flag != 'dislike' %}outline{% endif %} icon"></i>
      <span>{{ blog.bloglikes_set.filter(flag='dislike').count() }}</span>
    </a>
  </div>

  {{ render_comment_tree(blog) }}
  {% include 'components/form.jinja2' %}


{% endblock %}
