{% extends 'base.jinja2' %}
{% from 'components/nickname.jinja2' import clickable_nickname with context %}

{% block title %}{{ blog.title }} - Blog - {% endblock %}

{% block page_header %}{{ blog.title }}{% endblock %}

{% block content %}

  <p>{{ clickable_nickname(blog.author, tiny=True) }} last edited at {{ blog.edit_time | date('Y-m-d H:i:s') }}
  {% if is_privileged %}<a href="{{ url('blog:update', blog.pk) }}"><i class="ui icon edit"></i></a>{% endif %}</p>
  {{ blog.text | markdown | safer | safe }}


  <div class="ui comments">
  {% for comment in comment_list %}
    <div class="comment">
      <a class="avatar">
        <img style="height:auto;" src="{{ comment.author.avatar_small.url }}">
      </a>
      <div class="content">
        {{ clickable_nickname(comment.author, tiny=True, additional_class="author") }}
        <div class="metadata">
          <div class="date">{{ comment.create_time | date('Y-m-d H:i:s') }}</div>
        </div>
        <div class="text">
          {{ comment.text | n2br | safer | safe }}
        </div>
        <div class="actions">
          <a class="reply">Reply</a>
        {% if comment.is_privileged %}
          <a class="delete post-link text red" data-link="{{ url('blog:delete_comment', comment.blog_id, comment.pk) }}">Delete</a>
        {% endif %}
        </div>
      </div>
    </div>
  {% endfor %}
    {% if request.user.is_authenticated %}
      <form class="ui reply form" action="{{ url('blog:add_comment', blog.pk) }}" method="POST">
        {% csrf_token %}
        <div class="field">
          <textarea id="comment-text" name="text" placeholder="Put down your comment here."></textarea>
        </div>
        <div class="ui primary submit labeled icon button">
          <i class="icon edit"></i> Add Comment
        </div>
      </form>
    {% endif %}
  </div>

{% endblock %}
