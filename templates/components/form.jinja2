{% include 'components/message.jinja2' %}

{% set error_exists = [] %}
{% for field in form %}
  {% if field.errors %}{% do error_exists.append(1) %}{% endif %}
{% endfor %}
{% if form.non_field_errors() %}
  {% do error_exists.append(1) %}
{% endif %}

<form class="ui form {% if error_exists %}error{% endif %}" action="{{ request.get_full_path() }}" method="post" enctype="multipart/form-data">
  {% csrf_token %}

  {% for field in form %}
    <div class="field {% if field.errors %}error{% endif %}">
      {% if field.field.widget.__class__.__name__ == 'CheckboxInput' %}
        <div class="ui checkbox">
          {{ render_field(field, {'placeholder': field.help_text, 'class': 'hidden'}) }}
          <label>{{ field.label }}</label>
        </div>
      {% elif field.field.widget.__class__.__name__ == 'ClearableFileInput' %}
        {{ field.label_tag() }}
        <input type="file" id="{{ field.id_for_label }}" name="avatar">
      {% elif field.field.widget.__class__.__name__ == 'CaptchaTextInput' %}
        {{ field.label_tag() }}
        {{ field }}
      {% else %}
        {{ field.label_tag() }}
        {{ render_field(field, {'placeholder': field.help_text}) }}
      {% endif %}
    </div>
  {% endfor %}

  <div class="ui error message">
    <div class="header">Should check something!</div>
    <ul class="list">
      {% for field in form %}
        {% for error in field.errors %}
          <li>{{ field.label }}: {{ error | escape }}</li>
        {% endfor %}
      {% endfor %}
      {% for error in form.non_field_errors() %}
        <li>{{ error | escape }}</li>
      {% endfor %}
    </ul>
  </div>

  <button type="submit" class="ui submit button">Submit</button>
</form>

<script>
  $(".ui.form").submit(function() {
    $(this).prop('loading', true);
  });
</script>