{% extends 'base.jinja2' %}
{% from 'components/nickname.jinja2' import clickable_nickname %}

{% block title %}Standings - {{ contest.title }} - {% endblock %}

{% block page_header %}Standings: {{ contest.title }}{% endblock %}

{% block content %}

{#  <div>#}
{#    <p>#}
{#      {% if contest.status == -1 %}#}
{#        Before start <span class="countdown" data-duration="{{ time_all }}" data-delta-seconds="{{ time_remaining }}"></span>#}
{#      {% elif contest.status == 0 %}#}
{#        Before close <span class="countdown" data-duration="{{ time_all }}" data-delta-seconds="{{ time_remaining }}"></span>#}
{#      {% else %}#}
{#        Contest finished#}
{#      {% endif %}#}
{#    </p>#}
{#  </div>#}
  <a href="{{ url('contest:dashboard', contest.pk) }}">Back to dashboard</a>
  <p>Your standing: {{ my_rank }}</p>

  {% if (contest.contest_problem_list | length) > 9 %}
    {% set column_style = 'collapsing' %}
  {% else %}
    {% set column_style = 'one wide' %}
  {% endif %}

  <table class="ui compact celled table">
    <thead>
      <tr class="ui center aligned">
      <th class="{{ column_style }}">#</th>
      <th class="ui left aligned">Who</th>
      <th class="collapsing">=</th>
      {% if contest.penalty_counts %}<th class="one wide">Penalty</th>{% endif %}
      {% for problem in contest.contest_problem_list %}
        <th class="{{ column_style }}">{{ problem.identifier }}</th>
      {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for rank in rank_list %}
        <tr class="ui center aligned">
          <td scope="row">{% if rank.rank %}{{ rank.rank }}{% endif %}</td>
          <td class="ui left aligned">
            <h5 class="ui header">
              <div class="content">
                {% if rank.user.star %}* {% endif %}{{ clickable_nickname(rank.user.user, tiny=True) }}
                {% if rank.user.comment %}
                  <div class="sub header">{{ rank.user.comment }}</div>
                {% endif %}
              </div>
            </h5>
          </td>
          <td>{{ rank.score }}</td>
          {% if contest.penalty_counts %}
          <td>{{ (rank.penalty / 60) | int }}</td>
          {% endif %}
          {% for problem in contest.contest_problem_list %}
            <td>
              {% set d = rank.detail[problem.problem_id] %}
              {% if d and d.attempt %}
                {% if d.solved %}
                  <span class="score text {% if d.first_blood %}blue{% else %}green{% endif %}">
                    {% if contest.scoring_method == 'acm' %}
                      +{% if d.attempt > 1 %}{{ d.attempt - 1 }}{% endif %}
                    {% else %}
                      {{ d.score }}
                    {% endif %}
                  </span><br>
                  {% if contest.penalty_counts %}
                    <span class="penalty">{{ (d.time / 60) | int }}</span>
                  {% endif %}
                {% else %}
                  {% if contest.scoring_method == 'oi' %}
                    {% if d.score %}
                      <span class="score text yellow">{{ d.score }}</span>
                    {% else %}
                      <span class="score text red">0</span>
                    {% endif %}
                  {% else %}
                    <span class="score negative text red">-{{ d.attempt }}</span>
                  {% endif %}
                {% endif %}
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if is_privileged %}
  <p>
    <a class="ui button" href="{{ url('contest:update_standings', contest.pk) }}">Update standings</a>
    <a class="ui button" href="{{ url('contest:download_standings', contest.pk) }}" target="_blank">Download</a>
  </p>
  {% endif %}

  {% if paginator %}
    {{ my_paginator() }}
  {% endif %}

{% endblock %}

{% block script %}
  <script src="/static/js/countdown.js"></script>
{% endblock %}