{% extends 'contest/base.jinja2' %}

{% block contest_title %}Clarification - {% endblock %}

{% block contest_content %}

  <div class="content-header">
    <h2>Clarification</h2>
  </div>
  <ul>
  <li>A contestant may submit a claim of ambiguity or error in a problem statement by submitting a clarification request to judges.</li>
  <li>Please keep an eye on the status displayed on the header.</li>
  <li><strong>No response</strong> means that you are instructed to read the problem statement carefully again.</li>
  <li>If your status becomes <strong>solved</strong>, it means that the judges agree that an ambiguity or error exists, and then a clarification will be issued to all contestants.</li>
  </ul>
  {% include 'components/message.jinja2' %}
  <form action="{{ url('contest:clarification', contest.pk) }}" method="post">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.path }}">
    <div class="form-group">
      <textarea class="form-control" name="message" id="message" rows="3" placeholder="Type in your message" required></textarea>
    </div>
    <button type="submit" class="btn btn-default">Submit</button>
  </form>
  <br><br>

  {% for clarification in clarification_list %}
    <div class="panel panel-{% if clarification.status == 'note' %}primary{% else %}default{% endif %}">
      <div class="panel-heading"><div class="panel-title">{{ clarification.get_status_display() }}</div></div>
      <div class="panel-body">
        {{ clarification.text | markdown | safe }}
        {% if clarification.status != 'note' %}
          <b>Answer: </b>{% if clarification.status == 'close' %}No response{% else %}{{ clarification.answer }}{% endif %}
        {% endif %}
        <div class="text-right">{{ clarification.author.get_username_display() | safe }} at {{ clarification.time | date('Y-m-d H:i:s') }}</div>
      </div>
      {% if is_privileged and clarification.status != 'note' %}
      <div class="panel-footer"><a href="{{ url('contest:clarification_toggle', contest.pk, clarification.pk, 'close') }}">No response
      </a> or <a href="{{ url('contest:clarification_toggle', contest.pk, clarification.pk, 'solve') }}">will be clarified
      </a> or <a class="answerLink" data-toggle="modal" data-url="{{ url('contest:clarification_answer', contest.pk, clarification.pk) }}" href="#clarifyModal">answer</a></div>
      {% endif %}
    </div>
  {% endfor %}

  {% if is_privileged %}
  <div class="modal fade" id="clarifyModal" tabindex="-1" role="dialog"
       aria-labelledby="clarifyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="clarifyModalLabel">Make a clarification</h4>
        </div>
        <form style="margin-bottom:0" id="clarificationForm" action="" method="post">
          <div class="modal-body">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <div class="form-group">
              <label for="list" class="form-control-label">Clarification</label>
              <textarea class="form-control" name="answer" id="answer" rows="7" placeholder="Clarification here."></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary modal-submit">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script>
    $('#clarifyModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var url = button.data('url');
      $(this).find('#clarificationForm').attr('action', url);
    });
  </script>
  {% endif %}

  {% include 'components/math_support.jinja2' %}

{% endblock %}