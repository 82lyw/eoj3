<div class="ui grid">
  <div class="twelve wide column">
    <div class="ui error message" v-if="errorMessage">
      <i class="close icon" v-on:click="clearErrorMessage"></i>
      [[ errorMessage ]]
    </div>
    <table class="ui celled striped table">
      <thead>
        <tr>
          <th colspan="4" style="text-align: right;">
            <div class="ui dropdown onhover">
              <button class="ui icon button positive compact text"><i class="plus icon"></i> Add</button>
              <div class="menu">
                <div class="item" v-on:click="showDialogWithOneForm" data-target="#program-file-edit" data-block="true"
                     data-action="{{ url('polygon:session_create_program_file', session.id) }}">
                  <i class="write icon"></i> Manually</div>
                <div class="item"><i class="upload icon"></i> Upload</div>
                <div class="item"><i class="cloud download icon"></i> Import</div>
              </div>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="file in appData.program_file_list" :key="file.filename">
          <td>
            <i class="file icon" v-if="file.used"></i>
            <i class="file outline icon" v-else></i>
            <span class="click-able" v-on:click="showUpdateCodeEditor" data-target="#program-file-edit"
                  data-block="true" data-action="{{ url('polygon:session_update_program_file', session.id) }}"
                  v-bind:data-raw-filename="file.filename" v-bind:data-filename="file.filename"
                  v-bind:data-type="file.type" v-bind:data-lang="file.lang"
                  data-get-content="{{ url('polygon:session_read_program', session.id) }}">
              [[ file.filename ]]</span>
          </td>
          <td class="right aligned collapsing">[[ file.modified_time ]]</td>
          <td class="right aligned collapsing">
            <div class="ui icon compact buttons">
              <button class="ui button" data-action="{{ url('polygon:session_delete_regular_file', session.id) }}"
                      v-bind:data-filename="file.filename" v-on:click="showDeleteDialog">
                <i class="trash icon"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="four wide column">
    <div class="ui info message">
      <div class="header">Quick Tips</div>
      <ul class="list">
        <li>Please mind the volume, do not upload something that is too large. And please, do not use it as a free webdisk. <b>You will be banned from EOJ for doing this.</b></li>
        <li>Sadly only preview for images are supported.</li>
        <li>To prevent contestants from "penetrating" your static files, all files are automatically given a random name when uploaded. Tags may be supported in the future.</li>
        <li>The <b>copy</b> button is used to copy the path of your file to clipboard. This can be directly used in your statement.</li>
      </ul>
    </div>
  </div>
</div>

{% call modal(title="Upload a new file", id="program-file-upload") %}
  <form class="ui form" action="{{ url('polygon:session_upload_regular_file', session.id) }}" method="POST">
    {% csrf_token %}
    <div class="field">
      <label for="files[]">Choose multiple files</label>
      <div class="ui fluid file input action">
        <input type="text" readonly>
        <input type="file" name="files[]" autocomplete="off" multiple>
        <div class="ui button">Select...</div>
      </div>
    </div>
  </form>
{% endcall %}


{% call modal(title="Add / Edit a program", id="program-file-edit", size="small") %}
  <form class="ui form" action="" method="POST">
    {% csrf_token %}
    <div class="field">
      <label>Filename</label>
      <input type="text" name="filename">
    </div>

    <div class="field">
      <label>Type</label>
      <div class="ui selection dropdown">
        <input type="hidden" name="type" data-important="true">
        <i class="dropdown icon"></i>
        <div class="text"></div>
        <div class="menu">
          <div class="item">Checker</div>
          <div class="item">Solution</div>
          <div class="item">Validator</div>
          <div class="item">Generator</div>
          <div class="item">Interactor</div>
        </div>
      </div>
    </div>

    <div class="field">
      <label>Language</label>
      <div class="ui selection dropdown">
        <input type="hidden" name="lang" data-important="true">
        <i class="dropdown icon"></i>
        <div class="text"></div>
        <div class="menu">
          {% for lang in lang_choices %}
            <div class="item" data-value="{{ lang[0] }}">{{ lang[1] }}</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="field">
      <label>Code</label>
      <textarea name="code" spellcheck="false"></textarea>
    </div>

  </form>
{% endcall %}